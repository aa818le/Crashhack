<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crash Signal Generator</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js"></script>
</head>
<body>
  <h2>Crash Signal Generator (Firebase)</h2>
  <div id="status">Starting...</div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

    // ðŸ”¹ Siz bergan config
    const firebaseConfig = {
      apiKey: "AIzaSyB1_XCbC777hKwxlilhMeq5Hpty1dvDT1I",
      authDomain: "giper-8fd92.firebaseapp.com",
      databaseURL: "https://giper-8fd92-default-rtdb.firebaseio.com",
      projectId: "giper-8fd92",
      storageBucket: "giper-8fd92.firebasestorage.app",
      messagingSenderId: "485740337398",
      appId: "1:485740337398:web:demoapp12345" // web uchun qoâ€˜shimcha yozildi
    };

    // ðŸ”¹ Init
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Random target generator
    function randomTarget() {
      let r = Math.random();
      if (r < 0.7) return (1 + Math.random() * 9);   // 1â€“10 koâ€˜proq
      else return (10 + Math.random() * 25);         // 10â€“35 kamroq
    }

    function startRound() {
      let coef = 1.0;
      let target = randomTarget();
      let duration = target * 0.5; // masalan 26x â‰ˆ 13s
      let stepTime = 100; // ms
      let growRate = (target - 1.0) / (duration * (1000/stepTime));

      document.getElementById("status").innerText = `â–¶ï¸ New Round: target ${target.toFixed(2)}x`;

      let interval = setInterval(() => {
        coef += growRate;
        if (coef < target) {
          set(ref(db, "signal/current"), {
            type: "coef",
            value: coef.toFixed(2),
            timestamp: Date.now()
          });
        } else {
          clearInterval(interval);
          set(ref(db, "signal/current"), {
            type: "crash",
            value: target.toFixed(2),
            timestamp: Date.now()
          });
          document.getElementById("status").innerText = `ðŸ’¥ Crash at ${target.toFixed(2)}x`;

          setTimeout(startRound, 10000); // 10s pause
        }
      }, stepTime);
    }

    // Boshlash
    startRound();
  </script>
</body>
</html>
